
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../planner/zones/">
      
      
        <link rel="next" href="../matsim/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>pam.read.diary - Population Activity Modeller (PAM)</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.26e3688c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../static/extras.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pam.read.diary" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Population Activity Modeller (PAM)" class="md-header__button md-logo" aria-label="Population Activity Modeller (PAM)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Population Activity Modeller (PAM)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              pam.read.diary
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/arup-group/pam/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Population Activity Modeller (PAM)" class="md-nav__button md-logo" aria-label="Population Activity Modeller (PAM)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Population Activity Modeller (PAM)
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/arup-group/pam/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../read_data/" class="md-nav__link">
        Reading data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../activity_plans/" class="md-nav__link">
        Activity plans
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../modelling_policy_impact/" class="md-nav__link">
        Modelling the impact of policies on populations
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/01_PAM_Getting_Started/" class="md-nav__link">
        PAM Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/02_Population_Basics/" class="md-nav__link">
        Population Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/03_Example_Generate_Random_Population/" class="md-nav__link">
        Example Generate Random Population
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/04_Example_Ingest_NTS_Diaries/" class="md-nav__link">
        Example Ingest NTS Diaries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/05_PAM_Policies_Walk_Through/" class="md-nav__link">
        PAM Policies Walk Through
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/06_PAM_Complex_Policies/" class="md-nav__link">
        PAM Complex Policies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/07_PAM_Point_Sampling/" class="md-nav__link">
        PAM Point Sampling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/08_PAM_Population_Activity_Plots/" class="md-nav__link">
        PAM Population Activity Plots
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/09_Travel_Plots/" class="md-nav__link">
        Travel Plots
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/10_Advanced_Spatial-Sampling_Demo/" class="md-nav__link">
        Advanced Spatial-Sampling Demo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/11_Advanced_Plan_Rescheduling/" class="md-nav__link">
        Advanced Plan Rescheduling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/12_Advanced_Adding_Vehicles/" class="md-nav__link">
        Advanced Adding Vehicles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/13_Advanced_Freight_Synthesis/" class="md-nav__link">
        Advanced Freight Synthesis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/14_Advanced_Plan_Cropping/" class="md-nav__link">
        Advanced Plan Cropping
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/15_Advanced_Choice/" class="md-nav__link">
        Advanced Choice
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../get_involved/" class="md-nav__link">
        Get involved
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../cli/" class="md-nav__link">
        CLI Reference
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../scoring/" class="md-nav__link">
        pam.scoring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../vehicle/" class="md-nav__link">
        pam.vehicle
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../activity/" class="md-nav__link">
        pam.activity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/" class="md-nav__link">
        pam.core
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../location/" class="md-nav__link">
        pam.location
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        pam.utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_7" >
      
      
      
        <label class="md-nav__link" for="__nav_9_7" id="__nav_9_7_label" tabindex="0">
          pam.write
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9_7">
          <span class="md-nav__icon md-icon"></span>
          pam.write
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../write/matrices/" class="md-nav__link">
        pam.write.matrices
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../write/diary/" class="md-nav__link">
        pam.write.diary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../write/matsim/" class="md-nav__link">
        pam.write.matsim
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_8" >
      
      
      
        <label class="md-nav__link" for="__nav_9_8" id="__nav_9_8_label" tabindex="0">
          pam.plot
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9_8">
          <span class="md-nav__icon md-icon"></span>
          pam.plot
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../plot/stats/" class="md-nav__link">
        pam.plot.stats
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../plot/plans/" class="md-nav__link">
        pam.plot.plans
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9_9" id="__nav_9_9_label" tabindex="0">
          pam.optimise
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9_9">
          <span class="md-nav__icon md-icon"></span>
          pam.optimise
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optimise/grid/" class="md-nav__link">
        pam.optimise.grid
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optimise/random/" class="md-nav__link">
        pam.optimise.random
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_10" >
      
      
      
        <label class="md-nav__link" for="__nav_9_10" id="__nav_9_10_label" tabindex="0">
          pam.array
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9_10">
          <span class="md-nav__icon md-icon"></span>
          pam.array
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../array/encode/" class="md-nav__link">
        pam.array.encode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../array/distance/" class="md-nav__link">
        pam.array.distance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../array/decode/" class="md-nav__link">
        pam.array.decode
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_11" >
      
      
      
        <label class="md-nav__link" for="__nav_9_11" id="__nav_9_11_label" tabindex="0">
          pam.planner
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9_11">
          <span class="md-nav__icon md-icon"></span>
          pam.planner
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../planner/od/" class="md-nav__link">
        pam.planner.od
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../planner/clustering/" class="md-nav__link">
        pam.planner.clustering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../planner/encoder/" class="md-nav__link">
        pam.planner.encoder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../planner/utils_planner/" class="md-nav__link">
        pam.planner.utils_planner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../planner/choice_location/" class="md-nav__link">
        pam.planner.choice_location
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../planner/zones/" class="md-nav__link">
        pam.planner.zones
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_12" checked>
      
      
      
        <label class="md-nav__link" for="__nav_9_12" id="__nav_9_12_label" tabindex="0">
          pam.read
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_12_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_9_12">
          <span class="md-nav__icon md-icon"></span>
          pam.read
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          pam.read.diary
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        pam.read.diary
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary" class="md-nav__link">
    pam.read.diary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.add_hhs_from_hhs_attributes" class="md-nav__link">
    add_hhs_from_hhs_attributes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.add_hhs_from_persons_attributes" class="md-nav__link">
    add_hhs_from_persons_attributes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.add_hhs_from_trips" class="md-nav__link">
    add_hhs_from_trips()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.add_persons_from_persons_attributes" class="md-nav__link">
    add_persons_from_persons_attributes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.add_persons_from_trips" class="md-nav__link">
    add_persons_from_trips()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.build_population" class="md-nav__link">
    build_population()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.from_to_travel_diary_read" class="md-nav__link">
    from_to_travel_diary_read()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.hh_person_df_to_dict" class="md-nav__link">
    hh_person_df_to_dict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.load_travel_diary" class="md-nav__link">
    load_travel_diary()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.sample_population" class="md-nav__link">
    sample_population()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.tour_based_travel_diary_read" class="md-nav__link">
    tour_based_travel_diary_read()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.trip_based_travel_diary_read" class="md-nav__link">
    trip_based_travel_diary_read()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../matsim/" class="md-nav__link">
        pam.read.matsim
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_13" >
      
      
      
        <label class="md-nav__link" for="__nav_9_13" id="__nav_9_13_label" tabindex="0">
          pam.operations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_13_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9_13">
          <span class="md-nav__icon md-icon"></span>
          pam.operations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/cropping/" class="md-nav__link">
        pam.operations.cropping
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/combine/" class="md-nav__link">
        pam.operations.combine
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_14" >
      
      
      
        <label class="md-nav__link" for="__nav_9_14" id="__nav_9_14_label" tabindex="0">
          pam.samplers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_14_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9_14">
          <span class="md-nav__icon md-icon"></span>
          pam.samplers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../samplers/time/" class="md-nav__link">
        pam.samplers.time
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../samplers/attributes/" class="md-nav__link">
        pam.samplers.attributes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../samplers/population/" class="md-nav__link">
        pam.samplers.population
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../samplers/spatial/" class="md-nav__link">
        pam.samplers.spatial
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../samplers/facility/" class="md-nav__link">
        pam.samplers.facility
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../samplers/basic/" class="md-nav__link">
        pam.samplers.basic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../samplers/tour/" class="md-nav__link">
        pam.samplers.tour
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_15" >
      
      
      
        <label class="md-nav__link" for="__nav_9_15" id="__nav_9_15_label" tabindex="0">
          pam.report
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_15_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9_15">
          <span class="md-nav__icon md-icon"></span>
          pam.report
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../report/stringify/" class="md-nav__link">
        pam.report.stringify
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../report/summary/" class="md-nav__link">
        pam.report.summary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../report/benchmarks/" class="md-nav__link">
        pam.report.benchmarks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_16" >
      
      
      
        <label class="md-nav__link" for="__nav_9_16" id="__nav_9_16_label" tabindex="0">
          pam.policy
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_16_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9_16">
          <span class="md-nav__icon md-icon"></span>
          pam.policy
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../policy/probability_samplers/" class="md-nav__link">
        pam.policy.probability_samplers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../policy/modifiers/" class="md-nav__link">
        pam.policy.modifiers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../policy/policies/" class="md-nav__link">
        pam.policy.policies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../policy/filters/" class="md-nav__link">
        pam.policy.filters
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary" class="md-nav__link">
    pam.read.diary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.add_hhs_from_hhs_attributes" class="md-nav__link">
    add_hhs_from_hhs_attributes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.add_hhs_from_persons_attributes" class="md-nav__link">
    add_hhs_from_persons_attributes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.add_hhs_from_trips" class="md-nav__link">
    add_hhs_from_trips()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.add_persons_from_persons_attributes" class="md-nav__link">
    add_persons_from_persons_attributes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.add_persons_from_trips" class="md-nav__link">
    add_persons_from_trips()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.build_population" class="md-nav__link">
    build_population()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.from_to_travel_diary_read" class="md-nav__link">
    from_to_travel_diary_read()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.hh_person_df_to_dict" class="md-nav__link">
    hh_person_df_to_dict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.load_travel_diary" class="md-nav__link">
    load_travel_diary()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.sample_population" class="md-nav__link">
    sample_population()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.tour_based_travel_diary_read" class="md-nav__link">
    tour_based_travel_diary_read()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pam.read.diary.trip_based_travel_diary_read" class="md-nav__link">
    trip_based_travel_diary_read()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>pam.read.diary</h1>

<div class="doc doc-object doc-module">


<a id="pam.read.diary"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="pam.read.diary.add_hhs_from_hhs_attributes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_hhs_from_hhs_attributes</span><span class="p">(</span><span class="n">population</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">hhs_attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#pam.read.diary.add_hhs_from_hhs_attributes" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>pam/read/diary.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_hhs_from_hhs_attributes</span><span class="p">(</span>
    <span class="n">population</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span>
    <span class="n">hhs_attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">hhs_attributes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding hhs from hhs_attributes&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">hid</span><span class="p">,</span> <span class="n">hh</span> <span class="ow">in</span> <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;hid&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">hid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">population</span><span class="o">.</span><span class="n">households</span><span class="p">:</span>
            <span class="n">hh_attributes</span> <span class="o">=</span> <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">hid</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="n">household</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Household</span><span class="p">(</span>
                <span class="n">hid</span><span class="p">,</span>
                <span class="n">attributes</span><span class="o">=</span><span class="n">hh_attributes</span><span class="p">,</span>
                <span class="n">freq</span><span class="o">=</span><span class="n">hh_attributes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">area</span><span class="o">=</span><span class="n">hh_attributes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;hzone&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">population</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">household</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="pam.read.diary.add_hhs_from_persons_attributes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_hhs_from_persons_attributes</span><span class="p">(</span><span class="n">population</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">persons_attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#pam.read.diary.add_hhs_from_persons_attributes" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>pam/read/diary.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_hhs_from_persons_attributes</span><span class="p">(</span>
    <span class="n">population</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span>
    <span class="n">persons_attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">persons_attributes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="s1">&#39;hzone&#39;</span> <span class="ow">in</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">hzone_lookup</span> <span class="o">=</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;hid&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;hid&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">hzone</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hzone_lookup</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding hhs from persons_attributes&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">hid</span><span class="p">,</span> <span class="n">hh_data</span> <span class="ow">in</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;hid&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">hid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">population</span><span class="o">.</span><span class="n">households</span><span class="p">:</span>
            <span class="n">hzone</span> <span class="o">=</span> <span class="n">hzone_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hid</span><span class="p">)</span>
            <span class="n">household</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Household</span><span class="p">(</span>
                <span class="n">hid</span><span class="p">,</span>
                <span class="n">area</span><span class="o">=</span><span class="n">hzone</span>
                <span class="p">)</span>
            <span class="n">population</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">household</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="pam.read.diary.add_hhs_from_trips" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_hhs_from_trips</span><span class="p">(</span><span class="n">population</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">trips</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#pam.read.diary.add_hhs_from_trips" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>pam/read/diary.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_hhs_from_trips</span><span class="p">(</span>
    <span class="n">population</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span>
    <span class="n">trips</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">trips</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding hhs from trips&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">hid</span><span class="p">,</span> <span class="n">hh_data</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;hid&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">hid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">population</span><span class="o">.</span><span class="n">households</span><span class="p">:</span>
            <span class="n">hzone</span> <span class="o">=</span> <span class="n">hh_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hzone&quot;</span><span class="p">)</span>
            <span class="n">household</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Household</span><span class="p">(</span>
                <span class="n">hid</span><span class="p">,</span>
                <span class="n">area</span><span class="o">=</span><span class="n">hzone</span>
                <span class="p">)</span>
            <span class="n">population</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">household</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="pam.read.diary.add_persons_from_persons_attributes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_persons_from_persons_attributes</span><span class="p">(</span><span class="n">population</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">persons_attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#pam.read.diary.add_persons_from_persons_attributes" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>pam/read/diary.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_persons_from_persons_attributes</span><span class="p">(</span>
    <span class="n">population</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span>
    <span class="n">persons_attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">persons_attributes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">persons_attributes_dict</span>  <span class="o">=</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;hid&#39;</span><span class="p">,</span><span class="s1">&#39;pid&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding persons from persons_attributes&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">hid</span><span class="p">,</span> <span class="n">hh_data</span> <span class="ow">in</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;hid&#39;</span><span class="p">):</span>
        <span class="n">household</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">household</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to find household </span><span class="si">{</span><span class="n">hid</span><span class="si">}</span><span class="s2"> in population - unable to add person.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">hh_data</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">household</span><span class="o">.</span><span class="n">people</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">person_attributes</span> <span class="o">=</span> <span class="n">persons_attributes_dict</span><span class="p">[</span><span class="n">hid</span><span class="p">,</span> <span class="n">pid</span><span class="p">]</span>

            <span class="n">person</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Person</span><span class="p">(</span>
                <span class="n">pid</span><span class="p">,</span>
                <span class="n">attributes</span><span class="o">=</span><span class="n">person_attributes</span><span class="p">,</span>
                <span class="n">home_area</span><span class="o">=</span><span class="n">person_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hzone&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">freq</span><span class="o">=</span><span class="n">person_attributes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">household</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="pam.read.diary.add_persons_from_trips" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_persons_from_trips</span><span class="p">(</span><span class="n">population</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">trips</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#pam.read.diary.add_persons_from_trips" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>pam/read/diary.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_persons_from_trips</span><span class="p">(</span>
    <span class="n">population</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span>
    <span class="n">trips</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">trips</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding persons from trips&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">pid</span><span class="p">),</span> <span class="n">hh_person_data</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;hid&#39;</span><span class="p">,</span> <span class="s1">&#39;pid&#39;</span><span class="p">]):</span>
        <span class="n">household</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">households</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">household</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to find household </span><span class="si">{</span><span class="n">hid</span><span class="si">}</span><span class="s2"> in population - unable to add person.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">household</span><span class="o">.</span><span class="n">people</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Person</span><span class="p">(</span>
            <span class="n">pid</span><span class="p">,</span>
            <span class="n">home_area</span><span class="o">=</span><span class="n">hh_person_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hzone&quot;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="n">household</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="pam.read.diary.build_population" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_population</span><span class="p">(</span><span class="n">trips</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">persons_attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">hhs_attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#pam.read.diary.build_population" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
  
      <p>Build a population of households and persons (without plans)
from available trips, persons_attributes and households_attributes
data.
Details of required table formats are in the README.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>trips</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>trips table</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>persons_attributes</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>persons attributes table</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>hhs_attributes</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>households attributes table</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pam.Population: population object</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>pam/read/diary.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_population</span><span class="p">(</span>
    <span class="n">trips</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">persons_attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hhs_attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build a population of households and persons (without plans)</span>
<span class="sd">    from available trips, persons_attributes and households_attributes</span>
<span class="sd">    data.</span>
<span class="sd">    Details of required table formats are in the README.</span>

<span class="sd">    Args:</span>
<span class="sd">        trips (Optional[pd.DataFrame]): trips table</span>
<span class="sd">        persons_attributes (Optional[pd.DataFrame]): persons attributes table</span>
<span class="sd">        hhs_attributes (Optional[pd.DataFrame]): households attributes table</span>

<span class="sd">    Returns:</span>
<span class="sd">        pam.Population: population object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">population</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Population</span><span class="p">()</span>
    <span class="n">add_hhs_from_hhs_attributes</span><span class="p">(</span><span class="n">population</span><span class="o">=</span><span class="n">population</span><span class="p">,</span> <span class="n">hhs_attributes</span><span class="o">=</span><span class="n">hhs_attributes</span><span class="p">)</span>
    <span class="n">add_hhs_from_persons_attributes</span><span class="p">(</span><span class="n">population</span><span class="o">=</span><span class="n">population</span><span class="p">,</span> <span class="n">persons_attributes</span><span class="o">=</span><span class="n">persons_attributes</span><span class="p">)</span>
    <span class="n">add_hhs_from_trips</span><span class="p">(</span><span class="n">population</span><span class="o">=</span><span class="n">population</span><span class="p">,</span> <span class="n">trips</span><span class="o">=</span><span class="n">trips</span><span class="p">)</span>
    <span class="n">add_persons_from_persons_attributes</span><span class="p">(</span><span class="n">population</span><span class="o">=</span><span class="n">population</span><span class="p">,</span> <span class="n">persons_attributes</span><span class="o">=</span><span class="n">persons_attributes</span><span class="p">)</span>
    <span class="n">add_persons_from_trips</span><span class="p">(</span><span class="n">population</span><span class="o">=</span><span class="n">population</span><span class="p">,</span> <span class="n">trips</span><span class="o">=</span><span class="n">trips</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">population</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="pam.read.diary.from_to_travel_diary_read" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_to_travel_diary_read</span><span class="p">(</span><span class="n">trips</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">persons_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">hhs_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">include_loc</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sort_by_seq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

<a href="#pam.read.diary.from_to_travel_diary_read" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
  
      <p>Turn Diary Plan tabular data inputs (derived from travel survey and attributes) into core population
format. This is a variation of the standard load_travel_diary() method because it does not require
activity inference or home location.
We expect broadly the same data schema except rather than purp (purpose) we use trips oact (origin activity)
and dact (destination activity).
:param trips: DataFrame
:param persons_attributes: DataFrame
:param hhs_attributes: DataFrame
:return: core.Population
:param include_loc=False, bool, optionally include location data as shapely Point geometries ('start_loc' and 'end_loc' columns)
:param sort_by_seq=None, optionally force trip sorting as True or False</p>

      <details class="quote">
        <summary>Source code in <code>pam/read/diary.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">from_to_travel_diary_read</span><span class="p">(</span>
    <span class="n">trips</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">persons_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hhs_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">include_loc</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">sort_by_seq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Turn Diary Plan tabular data inputs (derived from travel survey and attributes) into core population</span>
<span class="sd">    format. This is a variation of the standard load_travel_diary() method because it does not require</span>
<span class="sd">    activity inference or home location.</span>
<span class="sd">    We expect broadly the same data schema except rather than purp (purpose) we use trips oact (origin activity)</span>
<span class="sd">    and dact (destination activity).</span>
<span class="sd">    :param trips: DataFrame</span>
<span class="sd">    :param persons_attributes: DataFrame</span>
<span class="sd">    :param hhs_attributes: DataFrame</span>
<span class="sd">    :return: core.Population</span>
<span class="sd">    :param include_loc=False, bool, optionally include location data as shapely Point geometries (&#39;start_loc&#39; and &#39;end_loc&#39; columns)</span>
<span class="sd">    :param sort_by_seq=None, optionally force trip sorting as True or False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">population</span> <span class="o">=</span> <span class="n">build_population</span><span class="p">(</span>
        <span class="n">trips</span><span class="o">=</span><span class="n">trips</span><span class="p">,</span>
        <span class="n">persons_attributes</span><span class="o">=</span><span class="n">persons_attributes</span><span class="p">,</span>
        <span class="n">hhs_attributes</span><span class="o">=</span><span class="n">hhs_attributes</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">sort_by_seq</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;seq&#39;</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">sort_by_seq</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">sort_by_seq</span><span class="p">:</span>
        <span class="n">trips</span> <span class="o">=</span> <span class="n">trips</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;hid&#39;</span><span class="p">,</span><span class="s1">&#39;pid&#39;</span><span class="p">,</span><span class="s1">&#39;seq&#39;</span><span class="p">])</span>

    <span class="n">trips_dict</span> <span class="o">=</span> <span class="n">hh_person_df_to_dict</span><span class="p">(</span><span class="n">trips</span><span class="p">,</span> <span class="s1">&#39;hid&#39;</span><span class="p">,</span> <span class="s1">&#39;pid&#39;</span><span class="p">)</span> <span class="c1"># convert to dict for faster indexing</span>

    <span class="k">for</span> <span class="n">hid</span><span class="p">,</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">population</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">household</span><span class="p">:</span>
            <span class="n">person_trips</span> <span class="o">=</span> <span class="n">trips_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">())</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">person_trips</span><span class="p">):</span>
                <span class="n">person</span><span class="o">.</span><span class="n">stay_at_home</span><span class="p">()</span>
                <span class="k">continue</span>

            <span class="n">first_act</span> <span class="o">=</span> <span class="n">person_trips</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">oact</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">first_act</span> <span class="o">==</span> <span class="s2">&quot;home&quot;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Person pid:</span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s2"> hid:</span><span class="si">{</span><span class="n">hid</span><span class="si">}</span><span class="s2"> plan does not start with &#39;home&#39; activity: </span><span class="si">{</span><span class="n">first_act</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">loc</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">include_loc</span><span class="p">:</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">person_trips</span><span class="o">.</span><span class="n">start_loc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">person</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">activity</span><span class="o">.</span><span class="n">Activity</span><span class="p">(</span>
                    <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">act</span><span class="o">=</span><span class="n">first_act</span><span class="p">,</span>
                    <span class="n">area</span><span class="o">=</span><span class="n">person_trips</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ozone</span><span class="p">,</span>
                    <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span>
                    <span class="n">start_time</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">trip</span> <span class="ow">in</span> <span class="n">person_trips</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>

                <span class="n">start_loc</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">end_loc</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">include_loc</span><span class="p">:</span>
                    <span class="n">start_loc</span> <span class="o">=</span> <span class="n">trip</span><span class="o">.</span><span class="n">start_loc</span>
                    <span class="n">end_loc</span> <span class="o">=</span> <span class="n">trip</span><span class="o">.</span><span class="n">end_loc</span>
                <span class="n">purpose</span><span class="o">=</span><span class="n">trip</span><span class="o">.</span><span class="n">dact</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

                <span class="n">person</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                    <span class="n">activity</span><span class="o">.</span><span class="n">Leg</span><span class="p">(</span>
                        <span class="n">seq</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                        <span class="n">purp</span><span class="o">=</span><span class="n">purpose</span><span class="p">,</span>
                        <span class="n">mode</span><span class="o">=</span><span class="n">trip</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                        <span class="n">start_area</span><span class="o">=</span><span class="n">trip</span><span class="o">.</span><span class="n">ozone</span><span class="p">,</span>
                        <span class="n">end_area</span><span class="o">=</span><span class="n">trip</span><span class="o">.</span><span class="n">dzone</span><span class="p">,</span>
                        <span class="n">start_loc</span><span class="o">=</span><span class="n">start_loc</span><span class="p">,</span>
                        <span class="n">end_loc</span><span class="o">=</span><span class="n">end_loc</span><span class="p">,</span>
                        <span class="n">start_time</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_time</span><span class="p">(</span><span class="n">trip</span><span class="o">.</span><span class="n">tst</span><span class="p">),</span>
                        <span class="n">end_time</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_time</span><span class="p">(</span><span class="n">trip</span><span class="o">.</span><span class="n">tet</span><span class="p">),</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">trip</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;distance&#39;</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">person</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                    <span class="n">activity</span><span class="o">.</span><span class="n">Activity</span><span class="p">(</span>
                        <span class="n">seq</span><span class="o">=</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">act</span><span class="o">=</span><span class="n">purpose</span><span class="p">,</span>
                        <span class="n">area</span><span class="o">=</span><span class="n">trip</span><span class="o">.</span><span class="n">dzone</span><span class="p">,</span>
                        <span class="n">loc</span><span class="o">=</span><span class="n">end_loc</span><span class="p">,</span>
                        <span class="n">start_time</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_time</span><span class="p">(</span><span class="n">trip</span><span class="o">.</span><span class="n">tet</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="n">person</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">finalise_activity_end_times</span><span class="p">()</span>
            <span class="n">household</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>

        <span class="n">population</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">household</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">population</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="pam.read.diary.hh_person_df_to_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">hh_person_df_to_dict</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">key_hh</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key_person</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span></code>

<a href="#pam.read.diary.hh_person_df_to_dict" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
  
      <p>Restructure a dataframe as a nested dictionary of dataframes,
    where the first level is the household index,
    the second level is the person index,
    the value is the dataframe slice corresponding to that person</p>
<p>The dictionary structure allows for much faster access to a person's data.
:params pd.DataFrame df: the pandas dataframe to reindex
:params str key_hh: the household key column name
:params str key_person: the person key column name
:params boolean values_dict: whether to convert the person data to a dictionary as well</p>

      <details class="quote">
        <summary>Source code in <code>pam/read/diary.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">hh_person_df_to_dict</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">key_hh</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">key_person</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Restructure a dataframe as a nested dictionary of dataframes,</span>
<span class="sd">        where the first level is the household index,</span>
<span class="sd">        the second level is the person index,</span>
<span class="sd">        the value is the dataframe slice corresponding to that person</span>

<span class="sd">    The dictionary structure allows for much faster access to a person&#39;s data.</span>
<span class="sd">    :params pd.DataFrame df: the pandas dataframe to reindex</span>
<span class="sd">    :params str key_hh: the household key column name</span>
<span class="sd">    :params str key_person: the person key column name</span>
<span class="sd">    :params boolean values_dict: whether to convert the person data to a dictionary as well</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:{}</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">key_hh</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()}</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">pid</span><span class="p">),</span> <span class="n">person_data</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">key_hh</span><span class="p">,</span><span class="n">key_person</span><span class="p">]):</span>
        <span class="n">df_dict</span><span class="p">[</span><span class="n">hid</span><span class="p">][</span><span class="n">pid</span><span class="p">]</span> <span class="o">=</span> <span class="n">person_data</span>
    <span class="k">return</span> <span class="n">df_dict</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="pam.read.diary.load_travel_diary" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_travel_diary</span><span class="p">(</span><span class="n">trips</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">persons_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">hhs_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sample_perc</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tour_based</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">from_to</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">include_loc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sort_by_seq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">trip_freq_as_person_freq</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">trip_freq_as_hh_freq</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

<a href="#pam.read.diary.load_travel_diary" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
  
      <p>Turn standard tabular data inputs (travel survey and attributes) into core population format.
:param trips: DataFrame
:param persons_attributes: DataFrame
:param hhs_attributes: DataFrame
:param sample_perc: Float. If different to None, it samples the travel population by the corresponding percentage
:param tour_based: bool=True, set to False to force a simpler trip-based purpose parser
:param from_to: bool=False, set to True to force the from-to purpose parser (requires 'oact' and 'dact' trips columns)
:param include_loc: bool=False, optionally include location data as shapely Point geometries ('start_loc' and 'end_loc' trips columns)
:param sort_by_seq=None, optionally force trip sorting as True or False
:param trip_freq_as_person_freq:bool=False.
:param trip_freq_as_hh_freq:bool=False.
:return: core.Population</p>

      <details class="quote">
        <summary>Source code in <code>pam/read/diary.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_travel_diary</span><span class="p">(</span>
    <span class="n">trips</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">persons_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hhs_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sample_perc</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tour_based</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">from_to</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">include_loc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">sort_by_seq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">trip_freq_as_person_freq</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">trip_freq_as_hh_freq</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Turn standard tabular data inputs (travel survey and attributes) into core population format.</span>
<span class="sd">    :param trips: DataFrame</span>
<span class="sd">    :param persons_attributes: DataFrame</span>
<span class="sd">    :param hhs_attributes: DataFrame</span>
<span class="sd">    :param sample_perc: Float. If different to None, it samples the travel population by the corresponding percentage</span>
<span class="sd">    :param tour_based: bool=True, set to False to force a simpler trip-based purpose parser</span>
<span class="sd">    :param from_to: bool=False, set to True to force the from-to purpose parser (requires &#39;oact&#39; and &#39;dact&#39; trips columns)</span>
<span class="sd">    :param include_loc: bool=False, optionally include location data as shapely Point geometries (&#39;start_loc&#39; and &#39;end_loc&#39; trips columns)</span>
<span class="sd">    :param sort_by_seq=None, optionally force trip sorting as True or False</span>
<span class="sd">    :param trip_freq_as_person_freq:bool=False.</span>
<span class="sd">    :param trip_freq_as_hh_freq:bool=False.</span>
<span class="sd">    :return: core.Population</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO check for required col headers and give useful error?</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trips</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempting to load trips dataframe from path: </span><span class="si">{</span><span class="n">trips</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">trips</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">trips</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">persons_attributes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempting to load trips dataframe from path: </span><span class="si">{</span><span class="n">persons_attributes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">persons_attributes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">persons_attributes</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hhs_attributes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempting to load trips dataframe from path: </span><span class="si">{</span><span class="n">hhs_attributes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">hhs_attributes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">hhs_attributes</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trips</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span><span class="s2">&quot;Unrecognised input for trips input.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">persons_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">persons_attributes</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span><span class="s2">&quot;Unrecognised input for person_attributes&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">hhs_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hhs_attributes</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span><span class="s2">&quot;Unrecognised input for hh_attributes&quot;</span><span class="p">)</span>

    <span class="c1"># reset indexes if named</span>
    <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="p">[</span><span class="n">trips</span><span class="p">,</span> <span class="n">persons_attributes</span><span class="p">,</span> <span class="n">hhs_attributes</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">table</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;oact&#39;</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;dact&#39;</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="ow">or</span> <span class="n">from_to</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Using from-to activity parser using &#39;oact&#39; and &#39;dact&#39; columns&quot;</span><span class="p">)</span>
        <span class="n">from_to</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># check that trips diary has required fields</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pid&#39;</span><span class="p">,</span> <span class="s1">&#39;ozone&#39;</span><span class="p">,</span> <span class="s1">&#39;dzone&#39;</span><span class="p">,</span> <span class="s1">&#39;oact&#39;</span><span class="p">,</span> <span class="s1">&#39;dact&#39;</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="s1">&#39;tst&#39;</span><span class="p">,</span> <span class="s1">&#39;tet&#39;</span><span class="p">}</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input trips_diary missing required column names: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tour_based</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Using tour based purpose parser (recommended)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Using simple trip based purpose parser, this assumes first activity is &#39;home&#39;.</span>
<span class="sd">If you do not wish to assume this, try setting &#39;tour_based&#39; = True (default).</span>
<span class="sd">&quot;&quot;&quot;</span>
                <span class="p">)</span>

        <span class="c1"># check that trips diary has required fields</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pid&#39;</span><span class="p">,</span> <span class="s1">&#39;ozone&#39;</span><span class="p">,</span> <span class="s1">&#39;dzone&#39;</span><span class="p">,</span> <span class="s1">&#39;purp&#39;</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="s1">&#39;tst&#39;</span><span class="p">,</span> <span class="s1">&#39;tet&#39;</span><span class="p">}</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input trips_diary missing required column names: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sort_by_seq</span> <span class="ow">and</span> <span class="s1">&#39;seq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    You must include a trips &#39;seq&#39; column if you wish to sort trips:</span>
<span class="s2">    Either include a &#39;seq&#39; column or use the existing ordering by</span>
<span class="s2">    setting &#39;sort_by_seq&#39; = False/None (default).</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">include_loc</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;start_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;end_loc&#39;</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    You must include a trips &#39;start_loc&#39; and &#39;end_loc&#39; column if you wish to use precise locations:</span>
<span class="s2">    Either include a &#39;start_loc&#39; and &#39;end_loc&#39; column or set &#39;include_loc&#39; = False (default).</span>
<span class="s2">    Note that these columns must be shapely Point geometries.</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">trip_freq_as_person_freq</span><span class="p">:</span>  <span class="c1"># use trip freq as person freq</span>
        <span class="k">if</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                You have opted to use &#39;trip_freq_as_person_freq&#39; but cannot build this mapping:</span>
<span class="s2">                Please check &#39;freq&#39; is included in the trips_diary input.</span>
<span class="s2">                &quot;&quot;&quot;</span>
                <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading person freq (&#39;freq&#39;) from trips_diary freq input.&quot;</span><span class="p">)</span>
        <span class="n">pid_freq_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">trips</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">trips</span><span class="o">.</span><span class="n">freq</span><span class="p">))</span>  <span class="c1"># this will take last freq from trips</span>

        <span class="k">if</span> <span class="n">persons_attributes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Building new person attributes dataframe to hold person frequency.&quot;</span><span class="p">)</span>
            <span class="n">persons_attributes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">pid_freq_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">pid_freq_map</span><span class="o">.</span><span class="n">values</span><span class="p">())})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding freq to person attributes using trip frequency.&quot;</span><span class="p">)</span>
            <span class="n">persons_attributes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">pid</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pid_freq_map</span><span class="p">)</span>

        <span class="n">trips</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">trip_freq_as_hh_freq</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                You have opted to use &#39;trip_freq_as_hh_freq&#39; but cannot build this mapping:</span>
<span class="s2">                Please check &#39;freq&#39; is included in the trips_diary input.</span>
<span class="s2">                &quot;&quot;&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                You have opted to use &#39;trip_freq_as_hh_freq&#39; but cannot build this mapping:</span>
<span class="s2">                Please check &#39;hid&#39; is included in the trips_diary input.</span>
<span class="s2">                &quot;&quot;&quot;</span>
                <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading houshold freq (&#39;freq&#39;) from trips_diary freq input.&quot;</span><span class="p">)</span>
        <span class="n">hid_freq_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">trips</span><span class="o">.</span><span class="n">hid</span><span class="p">,</span> <span class="n">trips</span><span class="o">.</span><span class="n">freq</span><span class="p">))</span>  <span class="c1"># this will take last freq from trips</span>

        <span class="k">if</span> <span class="n">hhs_attributes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Building new household attributes dataframe to hold houshold frequency.&quot;</span><span class="p">)</span>
            <span class="n">hhs_attributes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;hid&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">hid_freq_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">hid_freq_map</span><span class="o">.</span><span class="n">values</span><span class="p">())})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding freq to household attributes using trip frequency.&quot;</span><span class="p">)</span>
            <span class="n">hhs_attributes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">hid</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">hid_freq_map</span><span class="p">)</span>

        <span class="n">trips</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># add hid to trips if not already added</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span> \
        <span class="ow">and</span> <span class="p">(</span><span class="n">persons_attributes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> \
        <span class="ow">and</span> <span class="p">(</span><span class="n">hhs_attributes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;pid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            No household entities found, households will be composed of individual persons using &#39;pid&#39;:</span>
<span class="sd">            If you wish to correct this, please add &#39;hid&#39; to either the trips or persons_attributes inputs.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="n">trips</span><span class="p">[</span><span class="s1">&#39;hid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trips</span><span class="o">.</span><span class="n">pid</span>


    <span class="c1"># check that person_attributes has required fields if used</span>
    <span class="k">if</span> <span class="n">persons_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;pid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;pid&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input person_attributes dataframe missing required unique identifier column: &#39;pid&#39;.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">persons_attributes</span> <span class="ow">and</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">in</span> <span class="n">trips</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Adding pid-&gt;hh mapping to persons_attributes from trips.&quot;</span><span class="p">)</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">trips</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">trips</span><span class="o">.</span><span class="n">hid</span><span class="p">))</span>
            <span class="n">persons_attributes</span><span class="p">[</span><span class="s1">&#39;hid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">pid</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;hzone&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">in</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hhs_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;hzone&#39;</span> <span class="ow">in</span> <span class="n">hhs_attributes</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Adding home locations to persons attributes using hhs_attributes.&quot;</span><span class="p">)</span>
                <span class="n">mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hhs_attributes</span><span class="o">.</span><span class="n">hid</span><span class="p">,</span> <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">hzone</span><span class="p">))</span>
                <span class="n">persons_attributes</span><span class="p">[</span><span class="s1">&#39;hzone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">hid</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;hzone&#39;</span> <span class="ow">in</span> <span class="n">trips</span> <span class="ow">and</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">in</span> <span class="n">trips</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Adding home locations to persons attributes using trips attributes.&quot;</span><span class="p">)</span>
                <span class="n">mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">trips</span><span class="o">.</span><span class="n">hid</span><span class="p">,</span> <span class="n">trips</span><span class="o">.</span><span class="n">hzone</span><span class="p">))</span>
                <span class="n">persons_attributes</span><span class="p">[</span><span class="s1">&#39;hzone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">hid</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>


    <span class="c1"># check if hh_attributes are being used</span>
    <span class="k">if</span> <span class="n">hhs_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;hid&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input hh_attributes dataframe missing required unique identifier column: &#39;hid&#39;.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using person to household mapping from trips_diary data&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">persons_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading person to household mapping for person_attributes from trips data&quot;</span><span class="p">)</span>
                <span class="n">person_hh_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">trips</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">trips</span><span class="o">.</span><span class="n">hid</span><span class="p">))</span>
                <span class="n">persons_attributes</span><span class="p">[</span><span class="s1">&#39;hid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">pid</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">person_hh_mapping</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">persons_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">in</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading person to household mapping from person_attributes data&quot;</span><span class="p">)</span>
            <span class="n">person_hh_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">persons_attributes</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">hid</span><span class="p">))</span>
            <span class="n">trips</span><span class="p">[</span><span class="s1">&#39;hid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trips</span><span class="o">.</span><span class="n">pid</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">person_hh_mapping</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            Household attributes found but failed to build person to household mapping from provided inputs:</span>
<span class="s2">            Please provide a household ID field (&#39;hid&#39;) in either the trips_diary or person_attributes inputs.</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;hzone&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">persons_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;hzone&#39;</span> <span class="ow">in</span> <span class="n">persons_attributes</span> <span class="ow">and</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">in</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Adding home locations to hhs attributes using persons_attributes.&quot;</span><span class="p">)</span>
                <span class="n">mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">persons_attributes</span><span class="o">.</span><span class="n">hid</span><span class="p">,</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">hzone</span><span class="p">))</span>
                <span class="n">hhs_attributes</span><span class="p">[</span><span class="s1">&#39;hzone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">hid</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;hzone&#39;</span> <span class="ow">in</span> <span class="n">trips</span> <span class="ow">and</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">in</span> <span class="n">trips</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Adding home locations to hhs attributes using trips attributes.&quot;</span><span class="p">)</span>
                <span class="n">mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">trips</span><span class="o">.</span><span class="n">hid</span><span class="p">,</span> <span class="n">trips</span><span class="o">.</span><span class="n">hzone</span><span class="p">))</span>
                <span class="n">hhs_attributes</span><span class="p">[</span><span class="s1">&#39;hzone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">hid</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>

    <span class="c1"># add hzone to trips_diary</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;hzone&#39;</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hhs_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;hzone&#39;</span> <span class="ow">in</span> <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading household area (&#39;hzone&#39;) from hh_attributes input.&quot;</span><span class="p">)</span>
            <span class="n">hh_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hhs_attributes</span><span class="o">.</span><span class="n">hid</span><span class="p">,</span> <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">hzone</span><span class="p">))</span>
            <span class="n">trips</span><span class="p">[</span><span class="s1">&#39;hzone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trips</span><span class="o">.</span><span class="n">hid</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">hh_mapping</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">persons_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;hzone&#39;</span> <span class="ow">in</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;hid&#39;</span> <span class="ow">in</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading household area (&#39;hzone&#39;) from person_attributes input.&quot;</span><span class="p">)</span>
            <span class="n">hh_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">persons_attributes</span><span class="o">.</span><span class="n">hid</span><span class="p">,</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">hzone</span><span class="p">))</span>
            <span class="n">trips</span><span class="p">[</span><span class="s1">&#39;hzone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trips</span><span class="o">.</span><span class="n">hid</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">hh_mapping</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Unable to load household area (&#39;hzone&#39;) - not found in trips_diary or unable to build from attributes.</span>
<span class="s2">        Pam will try to infer home location from activities, but this behaviour is not recommended.</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Add an empty frequency fields if required</span>
    <span class="k">if</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Using freq of &#39;None&#39; for all trips.&quot;</span><span class="p">)</span>
        <span class="n">trips</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">persons_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Using freq of &#39;None&#39; for all persons.&quot;</span><span class="p">)</span>
        <span class="n">persons_attributes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">hhs_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Using freq of &#39;None&#39; for all households.&quot;</span><span class="p">)</span>
        <span class="n">hhs_attributes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">sample_perc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                You have opted to use a sample (</span><span class="si">{</span><span class="n">sample_perc</span><span class="si">}</span><span class="s2">, but this option requires that trips frequencies are set:):</span>
<span class="s2">                Please add a &#39;freq&#39; column to the trips dataframe or remove sampling (set &#39;sample_perc&#39; = None).</span>
<span class="s2">                &quot;&quot;&quot;</span>
                <span class="p">)</span>
        <span class="n">trips</span> <span class="o">=</span> <span class="n">sample_population</span><span class="p">(</span>
            <span class="n">trips</span><span class="o">=</span><span class="n">trips</span><span class="p">,</span>
            <span class="n">sample_perc</span><span class="o">=</span><span class="n">sample_perc</span><span class="p">,</span>
            <span class="n">weight_col</span><span class="o">=</span><span class="s1">&#39;freq&#39;</span>
            <span class="p">)</span>  <span class="c1"># sample the travel population</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Resetting trips index if required&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">trips</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">persons_attributes</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">persons_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting persons_attributes index to pid&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">persons_attributes</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;pid&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;pid&#39;</span><span class="p">:</span>
            <span class="n">persons_attributes</span> <span class="o">=</span> <span class="n">persons_attributes</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;pid&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">hhs_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting households_attributes index to hid&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;hid&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;hid&#39;</span><span class="p">:</span>
            <span class="n">hhs_attributes</span> <span class="o">=</span> <span class="n">hhs_attributes</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;hid&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">from_to</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Initiating from-to parser.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">from_to_travel_diary_read</span><span class="p">(</span>
            <span class="n">trips</span> <span class="o">=</span> <span class="n">trips</span><span class="p">,</span>
            <span class="n">persons_attributes</span> <span class="o">=</span> <span class="n">persons_attributes</span><span class="p">,</span>
            <span class="n">hhs_attributes</span> <span class="o">=</span> <span class="n">hhs_attributes</span><span class="p">,</span>
            <span class="n">include_loc</span> <span class="o">=</span> <span class="n">include_loc</span><span class="p">,</span>
            <span class="n">sort_by_seq</span>  <span class="o">=</span> <span class="n">sort_by_seq</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">tour_based</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Initiating tour-based parser.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tour_based_travel_diary_read</span><span class="p">(</span>
            <span class="n">trips</span> <span class="o">=</span> <span class="n">trips</span><span class="p">,</span>
            <span class="n">persons_attributes</span> <span class="o">=</span> <span class="n">persons_attributes</span><span class="p">,</span>
            <span class="n">hhs_attributes</span> <span class="o">=</span> <span class="n">hhs_attributes</span><span class="p">,</span>
            <span class="n">include_loc</span> <span class="o">=</span> <span class="n">include_loc</span><span class="p">,</span>
            <span class="n">sort_by_seq</span>  <span class="o">=</span> <span class="n">sort_by_seq</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Initiating trip-based parser.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">trip_based_travel_diary_read</span><span class="p">(</span>
        <span class="n">trips</span> <span class="o">=</span> <span class="n">trips</span><span class="p">,</span>
        <span class="n">persons_attributes</span> <span class="o">=</span> <span class="n">persons_attributes</span><span class="p">,</span>
        <span class="n">hhs_attributes</span> <span class="o">=</span> <span class="n">hhs_attributes</span><span class="p">,</span>
        <span class="n">include_loc</span> <span class="o">=</span> <span class="n">include_loc</span><span class="p">,</span>
        <span class="n">sort_by_seq</span> <span class="o">=</span> <span class="n">sort_by_seq</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="pam.read.diary.sample_population" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sample_population</span><span class="p">(</span><span class="n">trips_df</span><span class="p">,</span> <span class="n">sample_perc</span><span class="p">,</span> <span class="n">attributes_df</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">weight_col</span> <span class="o">=</span> <span class="s1">&#39;freq&#39;</span><span class="p">)</span></code>

<a href="#pam.read.diary.sample_population" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
  
      <p>Return the trips of a random sample of the travel population.
We merge the trips and attribute datasets to enable probability weights based on population demographics.</p>
<p>:params DataFrame trips_df: Trips dataset
:params DataFrame attributes_df: Population attributes dataset.
:params float sample_perc: Sampling percentage
:params string weight_col: The field to use for probability weighting</p>
<p>:return: Pandas DataFrame, a sampled version of the trips_df dataframe</p>

      <details class="quote">
        <summary>Source code in <code>pam/read/diary.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sample_population</span><span class="p">(</span><span class="n">trips_df</span><span class="p">,</span> <span class="n">sample_perc</span><span class="p">,</span> <span class="n">attributes_df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weight_col</span><span class="o">=</span><span class="s1">&#39;freq&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the trips of a random sample of the travel population.</span>
<span class="sd">    We merge the trips and attribute datasets to enable probability weights based on population demographics.</span>

<span class="sd">    :params DataFrame trips_df: Trips dataset</span>
<span class="sd">    :params DataFrame attributes_df: Population attributes dataset.</span>
<span class="sd">    :params float sample_perc: Sampling percentage</span>
<span class="sd">    :params string weight_col: The field to use for probability weighting</span>

<span class="sd">    :return: Pandas DataFrame, a sampled version of the trips_df dataframe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">attributes_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sample_pids</span> <span class="o">=</span> <span class="n">trips_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;pid&#39;</span><span class="p">)[[</span><span class="s1">&#39;freq&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">attributes_df</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
            <span class="n">frac</span><span class="o">=</span><span class="n">sample_perc</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weight_col</span>
            <span class="p">)</span><span class="o">.</span><span class="n">index</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sample_pids</span> <span class="o">=</span> <span class="n">trips_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;pid&#39;</span><span class="p">)[[</span><span class="s1">&#39;freq&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
            <span class="n">frac</span><span class="o">=</span><span class="n">sample_perc</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weight_col</span>
            <span class="p">)</span><span class="o">.</span><span class="n">index</span>

    <span class="k">return</span> <span class="n">trips_df</span><span class="p">[</span><span class="n">trips_df</span><span class="o">.</span><span class="n">pid</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sample_pids</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="pam.read.diary.tour_based_travel_diary_read" class="doc doc-heading">
<code class="highlight language-python"><span class="n">tour_based_travel_diary_read</span><span class="p">(</span><span class="n">trips</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">persons_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">hhs_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">include_loc</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sort_by_seq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#pam.read.diary.tour_based_travel_diary_read" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
  
      <p>Complex travel diray reader. Will try to infer home activiity and tour based purposes.
:param trips: DataFrame
:param persons_attributes: DataFrame
:param hhs_attributes: DataFrame
:param include_loc=False, bool, optionally include location data as shapely Point geometries ('start_loc' and 'end_loc' columns)
:param sort_by_seq=None, optionally force trip sorting as True or False
:return: core.Population</p>

      <details class="quote">
        <summary>Source code in <code>pam/read/diary.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tour_based_travel_diary_read</span><span class="p">(</span>
    <span class="n">trips</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">persons_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hhs_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">include_loc</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">sort_by_seq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Complex travel diray reader. Will try to infer home activiity and tour based purposes.</span>
<span class="sd">    :param trips: DataFrame</span>
<span class="sd">    :param persons_attributes: DataFrame</span>
<span class="sd">    :param hhs_attributes: DataFrame</span>
<span class="sd">    :param include_loc=False, bool, optionally include location data as shapely Point geometries (&#39;start_loc&#39; and &#39;end_loc&#39; columns)</span>
<span class="sd">    :param sort_by_seq=None, optionally force trip sorting as True or False</span>
<span class="sd">    :return: core.Population</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">population</span> <span class="o">=</span> <span class="n">build_population</span><span class="p">(</span>
        <span class="n">trips</span><span class="o">=</span><span class="n">trips</span><span class="p">,</span>
        <span class="n">persons_attributes</span><span class="o">=</span><span class="n">persons_attributes</span><span class="p">,</span>
        <span class="n">hhs_attributes</span><span class="o">=</span><span class="n">hhs_attributes</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">sort_by_seq</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;seq&#39;</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">sort_by_seq</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">sort_by_seq</span><span class="p">:</span>
        <span class="n">trips</span> <span class="o">=</span> <span class="n">trips</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;hid&#39;</span><span class="p">,</span><span class="s1">&#39;pid&#39;</span><span class="p">,</span><span class="s1">&#39;seq&#39;</span><span class="p">])</span>

    <span class="n">trips_dict</span> <span class="o">=</span> <span class="n">hh_person_df_to_dict</span><span class="p">(</span><span class="n">trips</span><span class="p">,</span> <span class="s1">&#39;hid&#39;</span><span class="p">,</span> <span class="s1">&#39;pid&#39;</span><span class="p">)</span> <span class="c1"># convert to dict for faster indexing</span>

    <span class="k">for</span> <span class="n">hid</span><span class="p">,</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">population</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">household</span><span class="p">:</span>
            <span class="n">person_trips</span> <span class="o">=</span> <span class="n">trips_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">())</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">person_trips</span><span class="p">):</span>
                <span class="n">person</span><span class="o">.</span><span class="n">stay_at_home</span><span class="p">()</span>
                <span class="k">continue</span>

            <span class="n">loc</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">include_loc</span><span class="p">:</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">person_trips</span><span class="o">.</span><span class="n">start_loc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">person</span> <span class="o">=</span> <span class="n">population</span><span class="p">[</span><span class="n">hid</span><span class="p">][</span><span class="n">pid</span><span class="p">]</span>

            <span class="n">person</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">activity</span><span class="o">.</span><span class="n">Activity</span><span class="p">(</span>
                    <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">act</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">area</span><span class="o">=</span><span class="n">person_trips</span><span class="o">.</span><span class="n">ozone</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span>
                    <span class="n">start_time</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">trip</span> <span class="ow">in</span> <span class="n">person_trips</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>

                <span class="n">start_loc</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">end_loc</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">include_loc</span><span class="p">:</span>
                    <span class="n">start_loc</span> <span class="o">=</span> <span class="n">trip</span><span class="o">.</span><span class="n">start_loc</span>
                    <span class="n">end_loc</span> <span class="o">=</span> <span class="n">trip</span><span class="o">.</span><span class="n">end_loc</span>

                <span class="n">person</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                    <span class="n">activity</span><span class="o">.</span><span class="n">Leg</span><span class="p">(</span>
                        <span class="n">seq</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                        <span class="n">purp</span><span class="o">=</span><span class="n">trip</span><span class="o">.</span><span class="n">purp</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                        <span class="n">mode</span><span class="o">=</span><span class="n">trip</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                        <span class="n">start_area</span><span class="o">=</span><span class="n">trip</span><span class="o">.</span><span class="n">ozone</span><span class="p">,</span>
                        <span class="n">end_area</span><span class="o">=</span><span class="n">trip</span><span class="o">.</span><span class="n">dzone</span><span class="p">,</span>
                        <span class="n">start_loc</span><span class="o">=</span><span class="n">start_loc</span><span class="p">,</span>
                        <span class="n">end_loc</span><span class="o">=</span><span class="n">end_loc</span><span class="p">,</span>
                        <span class="n">start_time</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_time</span><span class="p">(</span><span class="n">trip</span><span class="o">.</span><span class="n">tst</span><span class="p">),</span>
                        <span class="n">end_time</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_time</span><span class="p">(</span><span class="n">trip</span><span class="o">.</span><span class="n">tet</span><span class="p">),</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">trip</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;distance&#39;</span><span class="p">),</span>
                        <span class="n">freq</span><span class="o">=</span><span class="n">trip</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">person</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                    <span class="n">activity</span><span class="o">.</span><span class="n">Activity</span><span class="p">(</span>
                        <span class="n">seq</span><span class="o">=</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">act</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">area</span><span class="o">=</span><span class="n">trip</span><span class="o">.</span><span class="n">dzone</span><span class="p">,</span>
                        <span class="n">loc</span><span class="o">=</span><span class="n">end_loc</span><span class="p">,</span>
                        <span class="n">start_time</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_time</span><span class="p">(</span><span class="n">trip</span><span class="o">.</span><span class="n">tet</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="n">person</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">finalise_activity_end_times</span><span class="p">()</span>
            <span class="n">person</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">infer_activities_from_tour_purpose</span><span class="p">()</span>
            <span class="n">person</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">set_leg_purposes</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">population</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="pam.read.diary.trip_based_travel_diary_read" class="doc doc-heading">
<code class="highlight language-python"><span class="n">trip_based_travel_diary_read</span><span class="p">(</span><span class="n">trips</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">persons_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">hhs_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">include_loc</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sort_by_seq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#pam.read.diary.trip_based_travel_diary_read" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
  
      <p>Turn Activity Plan tabular data inputs (derived from travel survey and attributes) into core population
format. This is a variation of the standard load_travel_diary() method because it does not require
activity inference. However all plans are expected to be tour based, so assumed to start and end at home.
We expect broadly the same data schema except rather than trip 'purpose' we use trips 'activity'.
:param trips: DataFrame
:param persons_attributes: DataFrame
:param hhs_attributes: DataFrame
:param include_loc=False, bool, optionally include location data as shapely Point geometries ('start_loc' and 'end_loc' columns)
:param sort_by_seq=None, optionally force trip sorting as True or False
:return: core.Population</p>

      <details class="quote">
        <summary>Source code in <code>pam/read/diary.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">trip_based_travel_diary_read</span><span class="p">(</span>
    <span class="n">trips</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">persons_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hhs_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">include_loc</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">sort_by_seq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Turn Activity Plan tabular data inputs (derived from travel survey and attributes) into core population</span>
<span class="sd">    format. This is a variation of the standard load_travel_diary() method because it does not require</span>
<span class="sd">    activity inference. However all plans are expected to be tour based, so assumed to start and end at home.</span>
<span class="sd">    We expect broadly the same data schema except rather than trip &#39;purpose&#39; we use trips &#39;activity&#39;.</span>
<span class="sd">    :param trips: DataFrame</span>
<span class="sd">    :param persons_attributes: DataFrame</span>
<span class="sd">    :param hhs_attributes: DataFrame</span>
<span class="sd">    :param include_loc=False, bool, optionally include location data as shapely Point geometries (&#39;start_loc&#39; and &#39;end_loc&#39; columns)</span>
<span class="sd">    :param sort_by_seq=None, optionally force trip sorting as True or False</span>
<span class="sd">    :return: core.Population</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">population</span> <span class="o">=</span> <span class="n">build_population</span><span class="p">(</span>
        <span class="n">trips</span><span class="o">=</span><span class="n">trips</span><span class="p">,</span>
        <span class="n">persons_attributes</span><span class="o">=</span><span class="n">persons_attributes</span><span class="p">,</span>
        <span class="n">hhs_attributes</span><span class="o">=</span><span class="n">hhs_attributes</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">sort_by_seq</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;seq&#39;</span> <span class="ow">in</span> <span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">sort_by_seq</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">sort_by_seq</span><span class="p">:</span>
        <span class="n">trips</span> <span class="o">=</span> <span class="n">trips</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;hid&#39;</span><span class="p">,</span><span class="s1">&#39;pid&#39;</span><span class="p">,</span><span class="s1">&#39;seq&#39;</span><span class="p">])</span>

    <span class="n">trips_dict</span> <span class="o">=</span> <span class="n">hh_person_df_to_dict</span><span class="p">(</span><span class="n">trips</span><span class="p">,</span> <span class="s1">&#39;hid&#39;</span><span class="p">,</span> <span class="s1">&#39;pid&#39;</span><span class="p">)</span> <span class="c1"># convert to dict for faster indexing</span>

    <span class="k">for</span> <span class="n">hid</span><span class="p">,</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">population</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">household</span><span class="p">:</span>
            <span class="n">person_trips</span> <span class="o">=</span> <span class="n">trips_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">())</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">person_trips</span><span class="p">):</span>
                <span class="n">person</span><span class="o">.</span><span class="n">stay_at_home</span><span class="p">()</span>
                <span class="k">continue</span>

            <span class="n">home_area</span> <span class="o">=</span> <span class="n">household</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">area</span> <span class="ow">or</span> <span class="n">person_trips</span><span class="o">.</span><span class="n">hzone</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">origin_area</span> <span class="o">=</span> <span class="n">person_trips</span><span class="o">.</span><span class="n">ozone</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">loc</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">include_loc</span><span class="p">:</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">person_trips</span><span class="o">.</span><span class="n">start_loc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">person</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">activity</span><span class="o">.</span><span class="n">Activity</span><span class="p">(</span>
                    <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">act</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">,</span>
                    <span class="n">area</span><span class="o">=</span><span class="n">origin_area</span><span class="p">,</span>
                    <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span>
                    <span class="n">start_time</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">trip</span> <span class="ow">in</span> <span class="n">person_trips</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>

                <span class="n">start_loc</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">end_loc</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">include_loc</span><span class="p">:</span>
                    <span class="n">start_loc</span> <span class="o">=</span> <span class="n">trip</span><span class="o">.</span><span class="n">start_loc</span>
                    <span class="n">end_loc</span> <span class="o">=</span> <span class="n">trip</span><span class="o">.</span><span class="n">end_loc</span>
                <span class="n">purpose</span> <span class="o">=</span> <span class="n">trip</span><span class="o">.</span><span class="n">purp</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

                <span class="n">person</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                    <span class="n">activity</span><span class="o">.</span><span class="n">Leg</span><span class="p">(</span>
                        <span class="n">seq</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                        <span class="n">purp</span><span class="o">=</span><span class="n">purpose</span><span class="p">,</span>
                        <span class="n">mode</span><span class="o">=</span><span class="n">trip</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                        <span class="n">start_area</span><span class="o">=</span><span class="n">trip</span><span class="o">.</span><span class="n">ozone</span><span class="p">,</span>
                        <span class="n">end_area</span><span class="o">=</span><span class="n">trip</span><span class="o">.</span><span class="n">dzone</span><span class="p">,</span>
                        <span class="n">start_loc</span><span class="o">=</span><span class="n">start_loc</span><span class="p">,</span>
                        <span class="n">end_loc</span><span class="o">=</span><span class="n">end_loc</span><span class="p">,</span>
                        <span class="n">start_time</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_time</span><span class="p">(</span><span class="n">trip</span><span class="o">.</span><span class="n">tst</span><span class="p">),</span>
                        <span class="n">end_time</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_time</span><span class="p">(</span><span class="n">trip</span><span class="o">.</span><span class="n">tet</span><span class="p">),</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">trip</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;distance&#39;</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">person</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                    <span class="n">activity</span><span class="o">.</span><span class="n">Activity</span><span class="p">(</span>
                        <span class="n">seq</span><span class="o">=</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">act</span><span class="o">=</span><span class="n">purpose</span><span class="p">,</span>
                        <span class="n">area</span><span class="o">=</span><span class="n">trip</span><span class="o">.</span><span class="n">dzone</span><span class="p">,</span>
                        <span class="n">loc</span><span class="o">=</span><span class="n">end_loc</span><span class="p">,</span>
                        <span class="n">start_time</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_time</span><span class="p">(</span><span class="n">trip</span><span class="o">.</span><span class="n">tet</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="n">person</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">finalise_activity_end_times</span><span class="p">()</span>
            <span class="n">household</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>

        <span class="n">population</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">household</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">population</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>